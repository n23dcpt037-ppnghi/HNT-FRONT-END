<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Ch·ªß Admin - HNT Admin Panel</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS N·ªôi Tuy·∫øn C∆° B·∫£n */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; color: #333; }
        .header { background-color: #002d5e; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .nav-bar { background-color: #004a99; padding: 10px 30px; display: flex; gap: 20px; }
        .nav-bar a { color: white; text-decoration: none; padding: 5px 10px; border-radius: 4px; transition: background-color 0.3s; }
        .nav-bar a:hover, .nav-bar a.active { background-color: #002d5e; }
        .container { padding: 30px; }
        .welcome-message { background-color: #e6f7ff; border: 1px solid #91d5ff; padding: 20px; border-radius: 8px; margin-bottom: 30px; font-size: 18px; color: #0050b3; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        .card h3 { margin-top: 0; color: #004a99; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        
        /* Loading animation */
        .count { font-size: 36px; font-weight: bold; color: #002d5e; display: block; margin: 10px 0; }
        .loading-text { font-size: 14px; color: #999; font-style: italic; }

        .footer { text-align: center; padding: 15px; background-color: #002d5e; color: white; font-size: 12px; position: fixed; bottom: 0; width: 100%; }
        
        /* Admin Header Styles */
        .admin-header { background-color: #003366; color: white; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo a { color: white; font-size: 1.5em; font-weight: bold; text-decoration: none; }
        .admin-nav a { color: rgba(255,255,255,0.8); margin: 0 15px; text-decoration: none; font-weight: 500; transition: color 0.3s; }
        .admin-nav a:hover { color: #ffc107; }
        .user-actions a { color: white; text-decoration: none; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 5px; }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const role = localStorage.getItem('role');

            if (!token || role !== 'admin') {
                alert('Truy c·∫≠p b·ªã t·ª´ ch·ªëi! Vui l√≤ng ƒëƒÉng nh·∫≠p quy·ªÅn Admin.');
                window.location.href = '../ƒën/login.html';
            }
        });
    </script>
</head>
<body>

     <header class="admin-header">
        <div class="header-container">
            <div class="logo">
                <a href="#">HNT Admin Panel</a>
            </div>
            <nav class="admin-nav">
                <a href="admin.html">Tuy·ªÉn Th·ªß</a>
                <a href="adminsp.html">S·∫£n Ph·∫©m</a>
                <a href="admindonhang.html">ƒê∆°n H√†ng</a>
                <a href="adminbao.html">Th√¥ng Tin</a>
                <a href="adminsk.html">S·ª± Ki·ªán</a>
            </nav>
            <div class="user-actions">
                <a href="#" onclick="logout()">ƒêƒÉng Xu·∫•t <i class="fas fa-sign-out-alt"></i></a>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="welcome-message">
            üëã Ch√†o m·ª´ng b·∫°n tr·ªü l·∫°i, <b>Admin</b>!
            <br>
            D∆∞·ªõi ƒë√¢y l√† s·ªë li·ªáu th·ªëng k√™ th·ª±c t·∫ø t·ª´ h·ªá th·ªëng.
        </div>
        
        <h2>üìä T·ªïng Quan H·ªá Th·ªëng</h2>

        <div class="dashboard-grid">

            <div class="card">
                <h3>Tuy·ªÉn Th·ªß üèä‚Äç‚ôÇÔ∏è</h3>
                <span class="count" id="cnt-athlete"><span class="loading-text">ƒêang t·∫£i...</span></span> 
                <p>T·ªïng s·ªë v·∫≠n ƒë·ªông vi√™n.</p>
            </div>

            <div class="card">
                <h3>S·∫£n Ph·∫©m üëï</h3>
                <span class="count" id="cnt-product"><span class="loading-text">ƒêang t·∫£i...</span></span>
                <p>T·ªïng s·ªë m·∫∑t h√†ng ƒëang b√°n.</p>
            </div>

            <div class="card">
                <h3>ƒê∆°n H√†ng üì¶</h3>
                <span class="count" id="cnt-order"><span class="loading-text">ƒêang t·∫£i...</span></span>
                <p>T·ªïng s·ªë ƒë∆°n h√†ng trong h·ªá th·ªëng.</p>
            </div>

            <div class="card">
                <h3>S·ª± Ki·ªán üìÖ</h3>
                <span class="count" id="cnt-event"><span class="loading-text">ƒêang t·∫£i...</span></span>
                <p>S·ªë s·ª± ki·ªán ƒë√£ t·∫°o.</p>
            </div>
            
            <div class="card">
                <h3>Tin T·ª©c/B√†i Vi·∫øt üì∞</h3>
                <span class="count" id="cnt-article"><span class="loading-text">ƒêang t·∫£i...</span></span>
                <p>T·ªïng s·ªë b√†i vi·∫øt.</p>
            </div>
            
        </div>
    </div>

    <footer class="main-footer admin-footer">
        <p>&copy; 2024 HNT Swim Club Official Merchandise. Ph√°t tri·ªÉn b·ªüi ƒê·ªôi ng≈© HNT.</p>
    </footer>

    <script>
        // H√†m ƒëƒÉng xu·∫•t
        function logout() {
            if(confirm('B·∫°n mu·ªën ƒëƒÉng xu·∫•t?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('role');
                window.location.href = '../ƒën/login.html';
            }
        }

        // H√†m t·∫£i th·ªëng k√™
        async function loadStats() {
            try {
                // G·ªçi API m√¨nh v·ª´a vi·∫øt trong index.js
                const response = await fetch('http://localhost:3000/api/dashboard/stats');
                
                if (!response.ok) {
                    throw new Error('L·ªói server');
                }

                const data = await response.json();
                console.log('Th·ªëng k√™:', data);

                // ƒêi·ªÅn s·ªë v√†o c√°c √¥ c√≥ ID t∆∞∆°ng ·ª©ng
                // K·ªπ thu·∫≠t s·ªë nh·∫£y (Animation) cho ƒë·∫πp
                animateValue("cnt-athlete", 0, data.athletes, 1000);
                animateValue("cnt-product", 0, data.products, 1000);
                animateValue("cnt-order", 0, data.orders, 1000);
                animateValue("cnt-event", 0, data.events || 0, 1000);
                animateValue("cnt-article", 0, data.articles || 0, 1000);

            } catch (error) {
                console.error(error);
                // N·∫øu l·ªói th√¨ hi·ªán s·ªë 0
                document.querySelectorAll('.count').forEach(el => el.textContent = '0');
            }
        }

        // H√†m t·∫°o hi·ªáu ·ª©ng s·ªë ch·∫°y ch·∫°y (cho n√≥ nguy hi·ªÉm)
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if (!obj) return;
            
            // N·∫øu end l√† 0 ho·∫∑c null
            if (!end) {
                obj.textContent = "0";
                return;
            }

            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                } else {
                    obj.innerHTML = end;
                }
            };
            window.requestAnimationFrame(step);
        }

        // Ch·∫°y ngay khi load trang
        loadStats();
    </script>
</body>
</html>